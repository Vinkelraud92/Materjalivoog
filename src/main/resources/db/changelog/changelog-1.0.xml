<databaseChangeLog
        xmlns="http://www.liquibase.org/xml/ns/dbchangelog"
        xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
        xsi:schemaLocation="http://www.liquibase.org/xml/ns/dbchangelog
         http://www.liquibase.org/xml/ns/dbchangelog/dbchangelog-3.8.xsd">

    <changeSet id="08.12.21 - initial database" author="Simon Felding">

        <createTable tableName="tag">
            <column name="tag_id" type="int" autoIncrement="true">
                <constraints primaryKey="true"/>
            </column>
            <column name="name" type="text"/>
        </createTable>

        <createTable tableName="category">
            <column name="category_id" type="int" autoIncrement="true">
                <constraints primaryKey="true"/>
            </column>
            <column name="name" type="text"/>
        </createTable>

        <createTable tableName="subcategory">
            <column name="subcategory_id" type="int" autoIncrement="true">
                <constraints primaryKey="true"/>
            </column>
            <column name="name" type="text"/>
            <column name="category_id" type="int">
                <constraints foreignKeyName="fk_category_to_subcategory" references="category(category_id)"/>
            </column>
        </createTable>

        <createTable tableName="payment">
            <column name="account_id" type="int" autoIncrement="true">
                <constraints primaryKey="true"/>
            </column>
            <column name="balance" type="int">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <createTable tableName="region">
            <column name="region_id" type="int" autoIncrement="true">
                <constraints primaryKey="true"/>
            </column>
            <column name="region_name" type="text">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <createTable tableName="user">
            <column name="user_id" type="int" autoIncrement="true">
                <constraints primaryKey="true"/>
            </column>
            <column name="user_name" type="text"/>
            <column name="account_number" type="int">
                <constraints foreignKeyName="fk_payment_to_user" references="payment(account_id)"/>
            </column>
            <column name="region" type="int">
                <constraints foreignKeyName="fk_region_to_user" references="region(region_id)"/>
            </column>
            <column name="billing_address" type="text">
                <constraints nullable="false"/>
            </column>
            <column name="shipping_address" type="text">
                <constraints nullable="false"/>
            </column>
            <column name="role" type="text">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <createTable tableName="user_media">
            <column name="media_id" type="int" autoIncrement="true">
                <constraints primaryKey="true"/>
            </column>
            <column name="user_id" type="int">
                <constraints foreignKeyName="fk_user_to_user_media" references="user(user_id)"/>
            </column>
            <column name="format" type="text">
                <constraints nullable="false"/>
            </column>
        </createTable>

        <createTable tableName="listing">
            <column name="listing_id" type="int" autoIncrement="true">
                <constraints primaryKey="true"/>
            </column>
            <column name="user_id" type="int">
                <constraints foreignKeyName="fk_user_to_listing" references="user(user_id)"/>
            </column>
            <column name="category" type="int">
                <constraints foreignKeyName="fk_category_to_listing" references="category(category_id)"/>
            </column>
            <column name="subcategory" type="int">
                <constraints foreignKeyName="fk_subcategory_to_listing" references="subcategory(subcategory_id)"/>
            </column>
            <column name="tag" type="int">
                <constraints foreignKeyName="fk_tag_to_listing" references="tag(tag_id)"/>
            </column>
            <column name="dead_stock" type="boolean">
                <constraints nullable="false"/>
            </column>
            <column name="title" type="text">
                <constraints nullable="false"/>
            </column>
            <column name="description_1" type="text">
                <constraints nullable="false"/>
            </column>
            <column name="unit_price" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="unit_type" type="text">
                <constraints nullable="false"/>
            </column>
            <column name="inventory" type="int">
                <constraints nullable="false"/>
            </column>
            <column name="in_stock" type="boolean">
                <constraints nullable="false"/>
            </column>
            <column name="profit" type="int"/>
            <column name="description_2" type="text"/>
            <column name="discount_price" type="int"/>
            <column name="discount_percentage" type="int"/>
            <column name="region" type="int">
                <constraints foreignKeyName="fk_region_to_listing_region" references="region(region_id)"/>
            </column>
            <column name="location" type="text">
                <constraints nullable="false"/>
            </column>
            <column name="restriction" type="text"/>
        </createTable>

        <createTable tableName="media">
            <column name="id" type="int">
                <constraints foreignKeyName="fk_user_media_to_media" references="user_media(media_id)"/>
            </column>
            <column name="listing_id" type="int">
                <constraints foreignKeyName="fk_listing_to_media" references="listing(listing_id)"/>
            </column>
        </createTable>

        <createTable tableName="listing_tag">
            <column name="listing_id" type="int">
                <constraints foreignKeyName="fk_listing_to_tag" references="listing(listing_id)"/>
            </column>
            <column name="tag_id" type="int">
                <constraints foreignKeyName="fk_tag_to_listing_tag" references="tag(tag_id)"/>
            </column>
        </createTable>

    </changeSet>

    <changeSet id="09.12.21 listing default values" author="SimonF">
        <addDefaultValue tableName="listing" columnName="location" defaultValue="unspecified"/>
        <addDefaultValue tableName="listing" columnName="inventory" defaultValue="0"/>
        <addDefaultValue tableName="listing" columnName="unit_type" defaultValue="m"/>
        <addDefaultValue tableName="listing" columnName="unit_price" defaultValue="1"/>
        <addDefaultValue tableName="listing" columnName="description_1" defaultValue="description"/>
        <addDefaultValue tableName="listing" columnName="title" defaultValue="heading"/>
        <addDefaultValue tableName="listing" columnName="in_stock" defaultValueBoolean="true"/>
        <addDefaultValue tableName="listing" columnName="dead_stock" defaultValueBoolean="true"/>
    </changeSet>

    <changeSet id="10.12.21 int types to double" author="SimonF">
        <modifyDataType tableName="listing" columnName="unit_price" newDataType="double"/>
        <modifyDataType tableName="listing" columnName="profit" newDataType="double"/>
        <modifyDataType tableName="listing" columnName="discount_price" newDataType="double"/>
        <modifyDataType tableName="listing" columnName="discount_percentage" newDataType="double"/>
        <modifyDataType tableName="payment" columnName="balance" newDataType="double"/>
    </changeSet>
</databaseChangeLog>
